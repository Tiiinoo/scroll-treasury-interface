{% extends "base.html" %}
{% block content %}
<div class="login-page">
    <div class="login-card">
        <div class="login-logo">
            <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
                <circle cx="20" cy="20" r="18" stroke="#FFEEDA" stroke-width="2.5" fill="none"/>
                <path d="M12 20 Q20 10 28 20 Q20 30 12 20Z" fill="#FFEEDA" opacity="0.3"/>
                <circle cx="20" cy="20" r="6" fill="#FFEEDA"/>
            </svg>
            <h1>Scroll DAO Treasury</h1>
        </div>
        <p class="login-subtitle">Sign in to manage transaction categories</p>
        <form id="login-form">
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" name="username" required autocomplete="username">
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" name="password" required autocomplete="current-password">
            </div>
            <div id="login-error" class="error-msg" style="display:none;"></div>
            <button type="submit" class="btn btn-primary btn-full">Sign In</button>
        </form>
        <a href="/" class="login-back">&larr; Back to Dashboard</a>
    </div>
</div>
<script>
document.getElementById('login-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const errEl = document.getElementById('login-error');
    errEl.style.display = 'none';
    try {
        const resp = await fetch('/api/login', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                username: document.getElementById('username').value,
                password: document.getElementById('password').value,
            }),
        });
        const data = await resp.json();
        if (data.success) {
            window.location.href = '/';
        } else {
            errEl.textContent = data.error || 'Login failed';
            errEl.style.display = 'block';
        }
    } catch (err) {
        errEl.textContent = 'Connection error';
        errEl.style.display = 'block';
    }
});
</script>
{% endblock %}
